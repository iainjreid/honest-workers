{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 5b1528f20bca01f1d10f","webpack:///./src/index.js","webpack:///./src/utils.js"],"names":["_workers","WeakMap","HonestWorkers","set","defaultThreads","uid","fn","workers","get","Error","src","threads","n","i","Worker","console","log","args","worker","length","onmessage","Promise","resolve","reject","e","data","postMessage","module","exports","createWorkerScript","blob","Blob","toString","type","URL","createObjectURL"],"mappings":"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","file":"honest-workers.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"honestWorkers\"] = factory();\n\telse\n\t\troot[\"honestWorkers\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 5b1528f20bca01f1d10f\n **/","'use strict'\n\n// Dependencies\nimport { createWorkerScript } from './utils'\n\nconst _workers = new WeakMap()\n\n/**\n * @description A module allowing developers to benefit from the wonderful Promise interface whilst enjoying the\n *              multi-threaded goodness provided by WebWorkers.\n */\nclass HonestWorkers {\n  constructor () {\n    _workers.set(this, {})\n\n    // Setup the default values\n    this.defaultThreads = 5\n  }\n\n  /**\n   * @description This method will register a new function or task using the supplied UID, provided that that UID has\n   *              not previously been used. For convenience, a reference to the newly registered item will be returned.\n   *\n   *              The function or task must adhere to the formatting in the example provided, and the UID must be a\n   *              unique string (in the context of the HonestWorker instance).\n   *\n   * @example\n   * honestWorkers.register('myTask', function (done) {\n   *   // ... do something snazzy\n   *\n   *   done()\n   * })\n   *\n   * @param {String}   uid - A unique name or identifier\n   * @param {Function} fn  - A function with no lexical dependance\n   *\n   * @return {Function} A reference to the new congifuration object\n   */\n  register (uid, fn) {\n    const workers = _workers.get(this)\n\n    // Ensure that the UID provided has not previously been used\n    if (workers[uid]) {\n      throw Error('The UID must be unique')\n    }\n\n    // Generate the script source using the provided function\n    const src = createWorkerScript(fn);\n\n    workers[uid] = {\n      src,\n      threads: ((n) => {\n        const threads = []\n        for (let i = 0; i < n;) {\n          threads[i++] = new Worker(src)\n        }\n        return threads\n      })(this.defaultThreads)\n    }\n    _workers.set(this, workers)\n\n    console.log(workers)\n\n    return workers[uid]\n  }\n\n  /**\n   * @param {String} uid  - A unique name or identifier\n   * @param {...Any} args - A list of arguements to be passed\n   *\n   * @return {Promise} A Promise dependant on the success of the task\n   */\n  execute (uid, ...args) {\n    let worker\n\n    // Ensure that the UID has been registered\n    if (!(worker = _workers.get(this)[uid])) {\n      throw Error('The UID has not been defined')\n    }\n\n    // Retrieve a reference to a free thread or create a new one\n    for (let i = 0, n = worker.threads.length; i < n; i++) {\n      if (!worker.threads[i].onmessage) {\n        worker = worker.threads[i]\n        break\n      }\n    }\n\n    if (!worker) {\n      worker = worker.threads[worker.threads.length] = new Worker(worker.src)\n    }\n\n    console.log(worker)\n\n    return new Promise((resolve, reject) => {\n      worker.onmessage = (e) => {\n        resolve(e.data)\n        worker.onmessage = null\n      }\n\n      worker.postMessage(args)\n    })\n  }\n\n  /**\n   * @return {Function} - A reference to the HonestWorkers class\n   */\n  get Class () {\n    return HonestWorkers\n  }\n}\n\nmodule.exports = new HonestWorkers()\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","'use strict'\n\nfunction createWorkerScript (fn) {\n  // Ensure that \"fn\" is a function\n  if (typeof fn !== 'function') {\n    throw Error('Worker script must be a function')\n  }\n\n  let blob = new Blob([\n    `self.onmessage = function (e) {\n      e.data[e.data.length] = function () {\n        if (!arguments.length) {\n          arguments = [null]\n        }\n        postMessage.apply(this, arguments)\n      }\n      return (${fn.toString()}).apply(this, e.data)\n    }`\n  ], { type: 'application/javascript' })\n\n  return URL.createObjectURL(blob)\n}\n\nexport { createWorkerScript }\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils.js\n **/"],"sourceRoot":""}